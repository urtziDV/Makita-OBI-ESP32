<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Makita OBI ESP32</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="./style.css">
    <script src="./chart.min.js"></script>
</head>

<body>

    <header class="topbar glass">
        <div class="header-left">
            <span class="logo">üîã</span>
            <div class="title-block">
                <div class="title">Makita OBI ESP32</div>
                <div class="subtitle" id="subtitle" data-i18n="subtitle">Diagn√≥stico de Bater√≠a</div>
            </div>
        </div>

        <div class="header-right">
            <div class="lang-block system-block">
                <button id="btnSystem" class="lang">‚öôÔ∏è</button>
            </div>
            <div class="lang-block theme-block">
                <button id="themeLight" class="lang">‚òÄÔ∏è</button>
                <button id="themeDark" class="lang">üåô</button>
            </div>
            <div class="lang-block">
                <button id="btnEN" class="lang">EN</button>
                <button id="btnES" class="lang active">ES</button>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Indicador de Estado Flotante -->
        <div class="header-status glass" id="statusWidget">
            <span id="statusText">Conectando...</span>
        </div>

        <div id="limitedSupportAlert" class="alert info glass hidden"></div>

        <!-- Secci√≥n de Comandos -->
        <section class="card glass">
            <div class="card-header">
                <h2 data-i18n="sectionTitle">Operaciones</h2>
            </div>

            <div class="actions-grid">
                <div class="switch-container">
                    <span class="switch-label" id="lblAutoPoll" data-i18n="lbl_auto">Auto-lectura</span>
                    <label class="switch" for="checkAuto">
                        <input type="checkbox" id="checkAuto" aria-labelledby="lblAutoPoll">
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="button-pair">
                    <button id="btnReadStatic" class="big btn-data" data-i18n="btn_read">Leer Info</button>
                    <button id="btnReadDynamic" class="big" disabled data-i18n="btn_dynamic">Leer Voltajes</button>
                </div>

                <div id="serviceActions" class="service-actions-block hidden">
                    <div class="button-pair">
                        <button id="btnClearErrors" class="big" disabled data-i18n="btn_clear_err">Resetear
                            Errores</button>
                        <button id="btnLed" class="big" disabled data-i18n="btn_led_test">Test LED</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Vista General de la Bater√≠a -->
        <section class="card glass hidden" id="overviewCard">
            <div class="card-header">
                <h2 data-i18n="section_overview">Estado del Paquete</h2>
                <div id="imbalanceBadge" class="imbalance-badge hidden"></div>
            </div>

            <!-- Tabla de Informaci√≥n -->
            <div class="kv" id="data-table"></div>

            <!-- Visualizaci√≥n de Celdas -->
            <div class="battery-container">
                <div class="battery-pack">
                    <div class="battery-cells" id="cellsArea">
                        <!-- Las celdas y n√∫meros se inyectan aqu√≠ v√≠a JS -->
                    </div>
                </div>
            </div>

            <div class="pack-summary" id="packSummary"></div>

            <!-- Diagn√≥stico Avanzado -->
            <div class="diag-grid">
                <div class="diag-item">
                    <span class="diag-label" data-i18n="lbl_soh">SOH (Salud)</span>
                    <div id="sohRing" class="soh-ring">--%</div>
                    <span id="sohLabel" class="diag-value">---</span>
                </div>
                <div class="diag-item">
                    <span class="diag-label" data-i18n="lbl_temp">Temperatura</span>
                    <div class="temp-gauges-container">
                        <div class="temp-gauge">
                            <div id="tempBar1" class="temp-bar"></div>
                        </div>
                        <div class="temp-gauge">
                            <div id="tempBar2" class="temp-bar"></div>
                        </div>
                    </div>
                    <span id="tempValues" class="diag-value">--¬∞C | --¬∞C</span>
                </div>
            </div>

            <!-- Modelo y Comparativa -->
            <div id="modelSection" class="analytics-section hidden">
                <span class="diag-label" data-i18n="lbl_model_compare">Comparativa de Modelo (Nominal)</span>
                <div class="model-grid" id="modelComparison">
                    <!-- Inyectado por JS -->
                </div>
            </div>

            <!-- Gr√°fico de Desbalanceo (HUD) -->
            <div class="analytics-section">
                <span class="diag-label" data-i18n="lbl_imbalance">Desbalanceo (HUD)</span>
                <div id="imbalanceHUD" class="hud-container">
                    <!-- Barras de desviaci√≥n inyectadas por JS -->
                </div>
            </div>

            <!-- Gr√°fico de Historial de Voltajes -->
            <div class="analytics-section">
                <span class="diag-label" data-i18n="lbl_history">Gr√°fico de Historial (Tiempo Real)</span>
                <div class="chart-container">
                    <canvas id="historyChart"></canvas>
                </div>
            </div>

            <!-- Asistente de Balanceo -->
            <div id="balanceSection" class="analytics-section hidden">
                <span class="diag-label balance-warning-label" data-i18n="lbl_balance_title">‚ö†Ô∏è Asistente de Balanceo
                    Manual</span>
                <div class="balance-assistant" id="balanceAssistant">
                    <!-- Instrucciones inyectadas por JS -->
                </div>
            </div>

            <div class="alerts" id="alertsArea"></div>

            <div class="report-block">
                <button id="btnExport" class="big pro-btn">
                    <span class="btn-icon">üìÑ</span> <span data-i18n="lbl_report">Generar informe</span>
                </button>
            </div>
        </section>

        <!-- Sistema y Actualizaci√≥n (Fuera de la tarjeta de bater√≠a) -->
        <section class="system-section hidden" id="systemSection">
            <div class="card glass">
                <div class="card-header">
                    <h2 data-i18n="lbl_system_title">Sistema & FW Update</h2>
                </div>
                <div class="system-card">
                    <div class="ota-container">
                        <input type="file" id="otaFile" accept=".bin" class="hidden" title="Archivo de firmware">
                        <button id="btnOta" class="pro-btn">
                            <span class="btn-icon">üì¶</span> <span>Actualizar Firmware (.bin)</span>
                        </button>
                        <div id="otaProgress" class="progress-bar-container hidden">
                            <div class="progress-bar-fill" id="otaBar"></div>
                        </div>
                    </div>

                    <hr class="system-divider">

                    <div class="wifi-config-container">
                        <h3 data-i18n="lbl_wifi_config">Configuraci√≥n WiFi (Modo Estaci√≥n)</h3>
                        <div class="input-group">
                            <input type="text" id="wifiSSID" placeholder="Nombre de red (SSID)"
                                data-i18n-hold="lbl_wifi_ssid">
                            <input type="password" id="wifiPass" placeholder="Contrase√±a"
                                data-i18n-hold="lbl_wifi_pass">
                        </div>
                        <button id="btnSaveWifi" class="pro-btn blue-btn">
                            <span class="btn-icon">üåê</span> <span data-i18n="btn_save_wifi">Conectar al WiFi</span>
                        </button>
                        <p class="hint" data-i18n="lbl_wifi_hint">El ESP32 se reiniciar√° para conectar. Mantendr√° el AP
                            Makita como respaldo.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Depuraci√≥n / Logs -->
        <details class="log-spoiler card small glass">
            <summary id="rawTitle" data-i18n="rawTitle">Consola de Sistema</summary>
            <pre id="log" class="logbox" data-i18n="log_waiting">Esperando conexi√≥n...</pre>
        </details>

        <div id="notification" class="hidden"></div>
        <div id="toast-container"></div>
    </main>

    <footer class="footer">
        <div id="footerText" data-i18n="footerText">Versi√≥n 1.1 ‚Ä¢ ESP32 Control</div>
    </footer>

    <script src="./app.js"></script>
</body>

</html>